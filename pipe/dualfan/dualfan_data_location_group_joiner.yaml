---
pipeline:
  name: dualfan_data_location_group_joiner
transform:
  image_pull_secrets: ["battelleecology-quay-read-all-pull-secret"]
  image: quay.io/battelleecology/file_joiner:14
  cmd: ["/bin/bash"]
  stdin:
    - "#!/bin/bash"
    - "python3 -m file_joiner.file_joiner_main"
  env:
    LOG_LEVEL: DEBUG
    OUT_PATH: /pfs/out
    RELATIVE_PATH_INDEX: "3"
    CONFIG: |
      ---
      input_paths:
        - path:
            name: DATA_PATH
            glob_pattern: /pfs/DATA_PATH/dualfan/**"
            # Join on source ID
            join_indices: [7]
        - path:
            name: LOCATION_PATH
            glob_pattern: /pfs/LOCATION_PATH/dualfan/**
            # Join on source ID
            join_indices: [4]
input:
  cross:
    - pfs:
        name: DATA_PATH
        repo: data_source_dualfan_linkmerge
        glob: /dualfan/*/*
        empty_files: true
    - pfs:
        name: LOCATION_PATH
        repo: location_asset
        glob: /dualfan/*
        empty_files: true
enable_stats: false
standby: false
