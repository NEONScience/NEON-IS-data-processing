---
pipeline:
  name: dualfan_data_location_group_joiner
transform:
  image_pull_secrets: ["battelleecology-quay-read-all-pull-secret"]
  image: quay.io/battelleecology/filter_joiner:2
  cmd: ["/bin/bash"]
  stdin:
    - "#!/bin/bash"
    - "python3 -m filter_joiner.filter_joiner_main"
  env:
    CONFIG: |
      ---
      input_paths:
        - path:
            name: DATA_PATH
            glob_pattern: /pfs/DATA_PATH/**
            # Join on source ID
            join_indices: [7]
        - path:
            name: LOCATION_PATH
            glob_pattern: /pfs/LOCATION_PATH/**
            # Join on source ID
            join_indices: [4]
    LOG_LEVEL: DEBUG
    OUT_PATH: /pfs/out
    RELATIVE_PATH_INDEX: "3"
input:
  join:
    - pfs:
        name: DATA_PATH
        repo: data_source_dualfan_linkmerge
        glob: /dualfan/*/*/*/(*)
        joinOn: $1
        empty_files: true
    - pfs:
        name: LOCATION_PATH
        repo: location_asset
        glob: /dualfan/(*)
        joinOn: $1
        empty_files: true
enable_stats: false
standby: false
