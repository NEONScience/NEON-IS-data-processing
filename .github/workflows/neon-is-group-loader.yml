name: "Build and push latest to nonprod"

on:
  workflow_dispatch:
  
env:
   # github pull request number 
   pr-number: ${{ github.event.pull_request.number }}
   GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN }}
  
    
jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
        contents: 'write'
        id-token: 'write'
    steps:
      - name: "Checkout"
        uses: "actions/checkout@v4"

      - name: Get short SHA
        run: echo "short_sha=$(git rev-parse --short HEAD)" >> $GITHUB_ENV
    
      - name: Build push and update
        uses: ./.github/actions/build-push-update
        with:
            image-tag: "${short_sha}"
