
apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: location-asset
spec:
  # You can set sensible defaults here, can override in the workflow
  arguments:
    parameters:
      - name: source-type
        value: li191r
      - name: log-level
        value: DEBUG
      - name: err-path
        value: /pfs/out/errored_datums
      - name: out-path
        value: /pfs/out
  templates:
    - name: run
      container:
        image: us-central1-docker.pkg.dev/neon-shared-service/neonscience/neon-is-loc-asset-loader:v1.1.0
        securityContext:
          runAsUser: 9999 
          runAsGroup: 9999
        command: ["/bin/bash", "-lc"]
        args:
          - |
            echo "$SOURCE_TYPE"
            python3 -m location_asset_loader.location_asset_loader_main
            ls -l $OUT_PATH
        env:
          - name: OUT_PATH
            value: "{{workflow.parameters.out-path}}"   # <- parameterized
          - name: ERR_PATH
            value: "{{workflow.parameters.err-path}}"   # <- parameterized
          - name: LOG_LEVEL
            value: "{{workflow.parameters.log-level}}"   # <- parameterized
          - name: SOURCE_TYPE
            value: "{{workflow.parameters.source-type}}"   # <- parameterized
        volumeMounts:
          - name: pdr-secret-vol
            mountPath: /var/db_secret
            readOnly: true
          - name: output-vol
            mountPath: /pfs
      volumes:
        - name: pdr-secret-vol
          secret:
            secretName: pdr-secret
        - name: output-vol
          emptyDir: { }
      resources:
        requests:
          memory: "100Mi"
          cpu: "150m"
        limits:
          memory: "300Mi"
          cpu: "500m"
